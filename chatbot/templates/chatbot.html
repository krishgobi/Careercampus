{% extends 'base.html' %}

{% block title %}AI Chatbot - Smart Campus Assistant{% endblock %}

{% block content %}
<div class="chatbot-page">
    <!-- Chat History Sidebar -->
    <div class="chat-history-sidebar">
        <div class="chat-history-header">
            <h3><i class="fas fa-history"></i> Chat History</h3>
            <button class="btn-new-chat" onclick="createNewChat()">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div class="chat-list" id="chatList">
            {% for chat in chats %}
            <div class="chat-item" data-chat-id="{{ chat.id }}" onclick="loadChat({{ chat.id }})">
                <div class="chat-item-content">
                    <h4>{{ chat.name }}</h4>
                    <p>{{ chat.updated_at|date:"M d, H:i" }}</p>
                </div>
                <div class="chat-actions">
                    <button onclick="event.stopPropagation(); renameChat({{ chat.id }})" title="Rename">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="event.stopPropagation(); exportChat({{ chat.id }})" title="Download PDF">
                        <i class="fas fa-download"></i>
                    </button>
                    <button onclick="event.stopPropagation(); deleteChat({{ chat.id } )" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            {% empty %}
            <p class="empty-state">No chats yet. Start a conversation!</p>
            {% endfor %}
        </div>
    </div>

    <!-- Chat Interface -->
    <div class="chat-container">
        <div class="chat-header">
            <div class="chat-title">
                <i class="fas fa-robot"></i>
                <span id="chatTitle">AI Assistant</span>
            </div>

            <div class="document-selector">
                <label><i class="fas fa-file"></i> Document:</label>
                <select id="documentSelect" onchange="switchDocument()">
                    <option value="">Select a document</option>
                    {% for doc in documents %}
                    <option value="{{ doc.id }}">{{ doc.title }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <i class="fas fa-graduation-cap"></i>
                <h2>Welcome to Smart Campus Assistant!</h2>
                <p>Select a document from the dropdown above and start asking questions about your course materials.</p>
            </div>
        </div>

        <div class="chat-input-container">
            <div class="chat-input">
                <input type="text" id="messageInput" placeholder="Ask a question about your document..."
                    onkeypress="handleKeyPress(event)">
                <button class="btn-send" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% load static %}
<script src="{% static 'js/chatbot.js' %}"></script>
{% endblock %}