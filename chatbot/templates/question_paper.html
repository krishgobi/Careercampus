{% extends 'base.html' %}
{% load static %}

{% block title %}Question Papers - கற்றல் AI{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/question-paper.css' %}">
{% endblock %}

{% block content %}
<div class="question-paper-container">
    <div class="qp-header">
        <h1><i class="fas fa-file-alt"></i> Question Paper Generator</h1>
        <p>Generate important questions or predict exam papers using AI</p>
    </div>

    <div class="qp-tabs">
        <button class="qp-tab active" data-tab="important">
            <i class="fas fa-star"></i> Important Questions
        </button>
        <button class="qp-tab" data-tab="predict">
            <i class="fas fa-brain"></i> Predict Paper
        </button>
    </div>

    <!-- Important Questions Tab -->
    <div class="qp-tab-content active" id="important-tab">
        <div class="qp-card">
            <h2>Generate Important Questions</h2>
            <p class="qp-subtitle">From topics or uploaded documents</p>

            <form id="important-form">
                <div class="form-group">
                    <label>Source Type</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="source_type" value="topic" checked>
                            <span>Topic/Text</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="source_type" value="document">
                            <span>Upload Document</span>
                        </label>
                    </div>
                </div>

                <div class="form-group" id="topic-input">
                    <label for="topic">Enter Topic or Content</label>
                    <textarea id="topic" name="topic" rows="4"
                        placeholder="Enter the topic or paste content here..."></textarea>
                </div>

                <div class="form-group hidden" id="document-input">
                    <label for="document">Upload Document</label>
                    <div class="drag-drop-zone" id="documentDropZone">
                        <i class="fas fa-cloud-upload-alt drag-drop-icon"></i>
                        <p class="drag-drop-text">Drag & drop your course material</p>
                        <p class="drag-drop-hint">or <span class="browse">browse files</span></p>
                        <p class="drag-drop-hint">PDF, DOCX, PPTX (Max 50MB)</p>
                    </div>
                    <input type="file" id="document" name="document" accept=".pdf,.docx,.pptx" style="display:none">
                </div>

                <div class="form-group">
                    <label for="subject">Subject Name</label>
                    <input type="text" id="subject" name="subject" placeholder="e.g., Physics, Mathematics">
                </div>

                <div class="form-group">
                    <label for="requirements">What questions do you need?</label>
                    <input type="text" id="requirements" name="requirements"
                        value="10 questions of 2 marks, 5 questions of 5 marks"
                        placeholder="e.g., 10 questions of 2 marks, 5 questions of 5 marks">
                    <small class="form-hint">Describe the questions you want</small>
                </div>

                <button type="submit" class="btn-generate">
                    <i class="fas fa-magic"></i> Generate Questions
                </button>
            </form>
        </div>
    </div>

    <!-- Predict Paper Tab -->
    <div class="qp-tab-content" id="predict-tab">
        <div class="qp-card">
            <h2>Predict Question Paper</h2>
            <p class="qp-subtitle">Upload previous year papers for AI prediction</p>

            <form id="predict-form">
                <div class="form-group">
                    <label for="prev-subject">Subject Name</label>
                    <input type="text" id="prev-subject" name="subject" placeholder="e.g., Computer Science" required>
                </div>

                <div class="form-group">
                    <label for="previous-papers">Upload Previous Papers</label>
                    <div class="drag-drop-zone" id="papersDropZone">
                        <i class="fas fa-cloud-upload-alt drag-drop-icon"></i>
                        <p class="drag-drop-text">Drag & drop previous papers</p>
                        <p class="drag-drop-hint">or <span class="browse">browse files</span></p>
                        <p class="drag-drop-hint">Multiple files supported • PDF, DOCX, PPTX</p>
                    </div>
                    <input type="file" id="previous-papers" name="previous_papers" multiple accept=".pdf,.docx,.pptx"
                        style="display:none">
                </div>

                <div class="form-group">
                    <label for="pred-requirements">What questions do you need?</label>
                    <input type="text" id="pred-requirements" name="requirements"
                        value="15 questions of 1 mark, 10 questions of 2 marks"
                        placeholder="e.g., 15 questions of 1 mark, 10 questions of 2 marks">
                    <small class="form-hint">Describe the questions you want predicted</small>
                </div>

                <button type="submit" class="btn-generate">
                    <i class="fas fa-brain"></i> Predict Questions
                </button>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loading">
        <div class="loader"></div>
        <p>Generating questions using AI...</p>
    </div>

    <!-- Results Section -->
    <div class="results-section hidden" id="results">
        <div class="results-header">
            <h2>Generated Questions</h2>
            <div class="results-actions">
                <button class="btn-learn" id="learn-btn">
                    <i class="fas fa-graduation-cap"></i> Learn with AI
                </button>
                <button class="btn-secondary" id="export-pdf">
                    <i class="fas fa-file-pdf"></i> Export PDF
                </button>
                <button class="btn-secondary" id="view-paper">
                    <i class="fas fa-eye"></i> View Full Paper
                </button>
            </div>
        </div>
        <div id="questions-display"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/question-paper.js' %}"></script>
<script>
    // Initialize drag & drop for document upload
    let docUpload = null;
    let papersUpload = null;

    document.addEventListener('DOMContentLoaded', function () {
        // Document upload drag & drop
        const docZone = document.getElementById('documentDropZone');
        if (docZone) {
            docUpload = new DragDropUpload('documentDropZone', 'document', {
                multiple: false,
                acceptedTypes: ['.pdf', '.docx', '.pptx'],
                maxSize: 50 * 1024 * 1024
            });
        }

        // Previous papers drag & drop
        const papersZone = document.getElementById('papersDropZone');
        if (papersZone) {
            papersUpload = new DragDropUpload('papersDropZone', 'previous-papers', {
                multiple: true,
                maxFiles: 10,
                acceptedTypes: ['.pdf', '.docx', '.pptx'],
                maxSize: 50 * 1024 * 1024
            });
        }
    });
</script>
{% endblock %}